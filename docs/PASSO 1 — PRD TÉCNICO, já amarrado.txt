**PASSO 1 ‚Äî PRD T√âCNICO**, j√° **amarrado ao motor fiel** que definimos.
Depois disso, fecho com o **PASSO 3 ‚Äî MVP**.

---

# üìÑ PASSO 1 ‚Äî PRD T√âCNICO (BASEADO NO MOTOR REAL)

## 1. Vis√£o do Produto

**Nome:** Peixeiro Raiz
**Tipo:** Web App + PWA
**Objetivo:** Executar c√°lculos alimentares e proje√ß√µes de crescimento de til√°pias **id√™nticos √† planilha original**, com controle de acesso via pagamento.

---

## 2. Escopo Funcional

### 2.1 O que o sistema FAZ

* Replica a l√≥gica da planilha c√©lula por c√©lula
* Calcula:

  * Biomassa
  * Ra√ß√£o di√°ria
  * Ra√ß√£o por trato
  * Ganho de peso
  * Proje√ß√£o semanal
  * Consumo acumulado
  * Custo
* Armazena simula√ß√µes
* Controla acesso por assinatura

### 2.2 O que o sistema N√ÉO faz (por enquanto)

* Sugest√£o autom√°tica de manejo
* Alertas inteligentes
* Integra√ß√£o com sensores
* Multi-esp√©cies

---

## 3. Requisitos N√£o Funcionais (cr√≠ticos)

* C√°lculo determin√≠stico
* Precis√£o num√©rica compat√≠vel com Excel
* Motor versionado
* Resultado nunca muda sem mudan√ßa expl√≠cita de vers√£o
* Lat√™ncia baixa (c√°lculo local)

---

## 4. Arquitetura

### 4.1 Frontend

* Vite + React (TypeScript)
* Roteamento: wouter
* Tailwind + Shadcn UI (Radix)
* Estado/requests: @tanstack/react-query
* PWA habilitado (vite-plugin-pwa)
* C√°lculo executado no frontend (offline) ou via Edge Function (online)

### 4.2 Backend

* Supabase

  * Auth
  * Postgres
  * RLS
  * Edge Functions (c√°lculo e webhooks)
  * Integra√ß√£o Cakto via webhook

---

## 5. Autentica√ß√£o e Acesso

### Fluxo

1. Usu√°rio cria conta
2. Sistema cria registro em `subscriptions`
3. Acesso inicial = **bloqueado**
4. Pagamento confirmado ‚Üí acesso liberado

### Controle

* ProtectedRoute no frontend verifica:
  * Usu√°rio autenticado?
  * `subscriptions.status === 'active'`?
  * √â admin? (bypass via `VITE_ADMIN_EMAILS`)

```tsx
if (!user) return <Redirect to="/" />
if (subscriptionStatus !== 'active' && !isAdmin) return <Redirect to="/paywall" />
```

---

## 6. Pagamento ‚úÖ IMPLEMENTADO

### Estrat√©gia

* Gateway: **Cakto**
* Assinatura semestral: R$ 47,00 a cada 6 meses
* Webhook ‚Üí Supabase Edge Function (`cakto-webhook`)
* Atualiza status da assinatura baseado em eventos
* V√≠nculo por email (mesmo email do checkout = email do app)

### Tabela `subscriptions`

* id
* user_id (unique)
* status (`blocked | active`)
* plan_id
* trial_end
* updated_at

### Tabela `cakto_entitlements`

* email (pk)
* status (`blocked | active`)
* last_event
* raw_payload
* updated_at

---

## 7. Modelagem de Dados

### 7.1 `feeding_simulations`

```ts
{
  id,
  user_id,
  engine_version,
  input_json,
  output_json,
  created_at
}
```

### 7.2 `engine_versions`

```ts
{
  version,
  description,
  created_at
}
```

---

## 8. Motor de C√°lculo (Regra Oficial)

* C√≥digo imut√°vel por vers√£o
* Cada simula√ß√£o grava:

  * inputs
  * outputs
  * vers√£o usada

‚ö†Ô∏è **Nunca recalcular dados antigos com motor novo.**

---

## 9. Crit√©rios de Aceite

* Mesmo input ‚Üí mesmo output da planilha
* Diferen√ßa m√°xima: 0,001
* Teste comparativo validado manualmente

---

# ‚úÖ PASSO 1 CONCLU√çDO

Voc√™ agora tem um **PRD t√©cnico real**, n√£o conceitual.
Isso j√° √© suficiente para qualquer ferramenta de IA dev trabalhar sem distorcer a l√≥gica.

---

# üñ•Ô∏è PASSO 3 ‚Äî MVP FUNCIONAL (EXECUT√ÅVEL)

Agora fechamos com o **produto m√≠nimo vi√°vel**, respeitando tudo acima.

---

## 1. Telas do MVP

### Tela 1 ‚Äî Login / Cadastro ‚úÖ

* Email
* Senha
* Supabase Auth

---

### Tela 2 ‚Äî Paywall ‚úÖ

* Mensagem clara com proposta de valor
* Bot√£o "Assinar na Cakto" (abre checkout externo)
* Bot√£o "J√° paguei / Revalidar acesso"
* Orienta√ß√£o: usar mesmo email do app

---

### Tela 3 ‚Äî Formul√°rio de C√°lculo ‚úÖ

Campos **vis√≠veis no formul√°rio**:

* Peso m√©dio inicial (g)
* Quantidade de peixes
* Temperatura (¬∞C)

Campos **internos** (valores padr√£o):

* Pre√ßo da ra√ß√£o: R$ 4,50/kg
* N√∫mero de semanas: 12
* Fase: Autodetect

---

### Tela 4 ‚Äî Resultado Imediato ‚úÖ

* Tipo de ra√ß√£o recomendada
* Ra√ß√£o por trato (g) - n√∫mero inteiro
* Tratos/dia
* (Dispon√≠vel no motor: biomassa, ra√ß√£o/dia, custo di√°rio, FCR)

---

### Tela 5 ‚Äî Proje√ß√£o (Parcial)

* Dados dispon√≠veis no motor (`projections[]`)
* Tabela semanal: pendente refina√ß√£o de UI
* Gr√°fico: Recharts importado, UI pendente

---

### Tela 6 ‚Äî Hist√≥rico de Simula√ß√µes ‚úÖ

* Lista simula√ß√µes salvas por usu√°rio
* Modal de detalhes
* Op√ß√£o de deletar

---

## 2. Fluxo T√©cnico do MVP ‚úÖ

```
Login (Supabase Auth)
  ‚Üì
Sync user + subscription (upsert)
  ‚Üì
Claim entitlement (se existir compra pr√©via)
  ‚Üì
Verifica subscription.status
  ‚Üì
[blocked] ‚Üí /paywall ‚Üí Checkout Cakto ‚Üí Webhook ‚Üí Libera
[active] ‚Üí /calculator
  ‚Üì
Formul√°rio
  ‚Üì
Motor de c√°lculo (local offline / Edge Function online)
  ‚Üì
Exibe resultado
  ‚Üì
Salva simula√ß√£o (se online)
```

---

## 3. O que torna esse MVP forte

* ‚úÖ J√° √© vend√°vel (paywall + Cakto integrado)
* ‚úÖ J√° √© confi√°vel (motor versionado)
* ‚úÖ J√° substitui a planilha
* ‚úÖ J√° cria depend√™ncia do usu√°rio
* ‚úÖ J√° permite escalar depois
* ‚úÖ Funciona offline (PWA)

---

# üéØ Status Atual (Janeiro 2026)

| Componente | Status |
|------------|--------|
| Autentica√ß√£o | ‚úÖ Implementado |
| Paywall | ‚úÖ Implementado |
| Integra√ß√£o Cakto | ‚úÖ Implementado |
| Webhook | ‚úÖ Funcionando |
| Calculadora | ‚úÖ Implementado |
| Hist√≥rico | ‚úÖ Implementado |
| Proje√ß√µes UI | ‚ö†Ô∏è Pendente refina√ß√£o |
| PWA | ‚úÖ Habilitado |

---

# üéØ Recomenda√ß√£o final (honesta)

Voc√™ n√£o est√° criando ‚Äúum app‚Äù.
Voc√™ est√° **empacotando um know-how validado**.



